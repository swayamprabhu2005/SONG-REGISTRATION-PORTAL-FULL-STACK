<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TUNEVAULT | Artists</title>
    <link rel="stylesheet" href="./css/emailphoto.css" />
    <link rel="stylesheet" href="/css/artists.css" />
    <style>
      .search-bar {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 1em 0;
        gap: 0.5em;
      }
      .search-bar input {
        padding: 0.6em 1em;
        width: 250px;
        border-radius: 10px;
        border: 1px solid #ccc;
        font-size: 1em;
      }
      .search-bar button {
        padding: 0.6em 1.2em;
        border: none;
        background: linear-gradient(90deg, #ff7a00, #ff3d00);
        color: white;
        border-radius: 10px;
        cursor: pointer;
      }
      .search-bar button:hover {
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="name logo-text">
          <span class="gradient-logo">TUNEVAULT</span>
        </div>
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="about.html">About Us</a></li>
          <li><a href="/artists" class="active">Artists</a></li>
          <li><a href="/songs">Songs</a></li>
          <li><a href="/albums">Albums</a></li>
          <li><a href="contactus.html">Contact Us</a></li>
        </ul>
        <a href="/login.html" class="login-btn">Login</a>
      </nav>
    </header>

    <main>
      <section class="artists-section" id="artists-section">
        <div class="artist-pane">
          <h1>Artists</h1>

          <!-- Search Bar -->
          <div class="search-bar">
            <input
              type="text"
              id="searchInput"
              placeholder="Search artists by name..."
            />
            <button id="searchBtn">Search</button>
          </div>

          <div id="artistGrid" class="artist-grid"></div>
        </div>

        <div id="artistSongs" class="song-list">
          <h2>Select an artist to view songs ðŸŽ¶</h2>
        </div>
      </section>
    </main>

    <script>
      const grid = document.getElementById("artistGrid");
      const searchInput = document.getElementById("searchInput");
      const searchBtn = document.getElementById("searchBtn");

      async function loadArtists() {
        const res = await fetch("/artists/api/list");
        const artists = await res.json();
        displayArtists(artists);
      }

      async function searchArtists() {
        const query = searchInput.value.trim();
        if (!query) {
          loadArtists();
          return;
        }
        const res = await fetch(
          `/artists/api/search?name=${encodeURIComponent(query)}`
        );
        const artists = await res.json();
        displayArtists(artists);
      }

      function displayArtists(artists) {
        grid.innerHTML = "";
        if (artists.length === 0) {
          grid.innerHTML = "<p>No artists found.</p>";
          return;
        }
        artists.forEach((a) => {
          const card = document.createElement("div");
          card.className = "artist-card";
          card.innerHTML = `
          <div class="artist-info">
            <h3>${a.artist_name}</h3>
            <button class="view-btn" onclick="showSongs('${a.artist_name}')">View Songs</button>
          </div>`;
          grid.appendChild(card);
        });
      }

      async function showSongs(artistName) {
        const res = await fetch(
          "/artists/api/" + encodeURIComponent(artistName) + "/songs"
        );
        const data = await res.json();
        const list = document.getElementById("artistSongs");
        list.style.display = "block";
        list.innerHTML = `<h2>Songs by ${data.artistName}</h2>
          <button class="back-btn" onclick="scrollToArtists()">View Artists</button>`;
        data.songs.forEach((song) => {
          list.innerHTML += `
          <div class="song-item">
            <span>${song.song_name}</span>
            ${
              song.role === "Main Artist"
                ? '<span class="song-tag">Main Artist</span>'
                : ""
            }
          </div>`;
        });
        document
          .getElementById("artistSongs")
          .scrollIntoView({ behavior: "smooth" });
      }

      function scrollToArtists() {
        document
          .getElementById("artists-section")
          .scrollIntoView({ behavior: "smooth" });
      }

      // Event listeners for search
      searchBtn.addEventListener("click", searchArtists);
      searchInput.addEventListener("keyup", (e) => {
        if (e.key === "Enter") searchArtists();
      });

      loadArtists();
    </script>
    <script type="module" src="./js/auth.js"></script>
  </body>
</html>
